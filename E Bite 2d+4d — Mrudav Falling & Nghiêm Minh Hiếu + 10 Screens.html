<!doctype html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>eBite — 2D/4D (Mrudav falling + Nghiêm Minh Hiếu)</title>
<style>
  :root{--bg:#071022;--accent:#ffcc00}
  html,body{height:100%;margin:0;background:var(--bg);color:#e6eef8;font-family:Inter,system-ui,Arial}
  .wrap{max-width:1200px;margin:12px auto;padding:12px}
  header{display:flex;align-items:center;gap:12px}
  h1{font-size:18px;margin:0}
  .controls{margin-top:12px;display:flex;gap:8px;flex-wrap:wrap}
  button{background:#fff;color:#111;border-radius:8px;padding:8px 10px;border:none;font-weight:700;cursor:pointer}
  .stage{margin-top:12px;border-radius:12px;overflow:hidden;background:linear-gradient(180deg,#07203a,#011028);height:680px;position:relative}
  canvas{display:block;width:100%;height:100%}
  .particle-layer{position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none}
  .flash{position:absolute;left:0;top:0;right:0;bottom:0;pointer-events:none;mix-blend-mode:screen;opacity:0}
  .time-layer{position:absolute;left:0;top:0;width:100%;height:100%;pointer-events:none;opacity:0}
  .ui{position:absolute;left:12px;top:12px;z-index:40;display:flex;flex-direction:column;gap:8px}
  .pill{background:rgba(255,255,255,0.06);backdrop-filter:blur(4px);padding:8px;border-radius:10px}
  .credits{position:absolute;right:12px;bottom:12px;background:rgba(0,0,0,0.5);padding:8px;border-radius:8px;font-size:13px}
  .badge{background:var(--accent);color:#08111a;padding:4px 8px;border-radius:999px;font-weight:800}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>eBite — 2D + 4D with Mrudav & Nghiêm Minh Hiếu</h1>
      <div class="badge">Updated</div>
    </header>

    <div class="controls">
      <button id="play">▶ Chạy</button>
      <button id="stop">⏹ Dừng</button>
      <button id="sensory">4D Cảm giác</button>
      <button id="timewarp">4D Thời-gian</button>
      <button id="surreal">4D Siêu-tưởng</button>
      <button id="download">⬇ Tải HTML</button>
    </div>

    <div class="stage" id="stage">
      <canvas id="main"></canvas>
      <div class="particle-layer" id="particles"></div>
      <div class="flash" id="flash"></div>
      <div class="time-layer" id="timelayer1"></div>
      <div class="time-layer" id="timelayer2"></div>

      <div class="ui">
        <div class="pill">Nhân vật: Nguyễn K.Bằng, Trần P.Nhi, Trần Đ.Mạnh, Quách D.Trường, Quách Duy Trường, Mrudav Prashant Mehta, Nghiêm Minh Hiếu</div>
        <div class="pill">Hiệu ứng: 4D cảm giác / thời-gian / siêu-tưởng • Lịch: Tháng 10 (ô 10 nổi bật)</div>
      </div>

      <div class="credits">Kênh: Trương Ngọc Anh Channel</div>
    </div>
  </div>

<script>
// eBite extended: adds Mrudav falling from airplane and Nghiêm Minh Hiếu with iPhone, TV and 10 screens
const canvas = document.getElementById('main'); const ctx = canvas.getContext('2d');
const stage = document.getElementById('stage'); const particlesEl = document.getElementById('particles');
const flash = document.getElementById('flash'); const tl1 = document.getElementById('timelayer1'); const tl2 = document.getElementById('timelayer2');
let W=1200,H=680; function resize(){ const r=stage.getBoundingClientRect(); W=r.width; H=r.height; canvas.width=W; canvas.height=H; tl1.style.width=W+'px'; tl1.style.height=H+'px'; tl2.style.width=W+'px'; tl2.style.height=H+'px'; } window.addEventListener('resize', resize); resize();

let playing=false, sensoryOn=false, timewarpOn=false, surrealOn=false;

// characters list (add Mrudav & Nghiem Minh Hieu)
const chars = [
  {name:'Nguyễn K.Bằng', x:220, color:{body:'#1e90ff',hair:'#3a2b2b'}},
  {name:'Trần P.Nhi', x:420, color:{body:'#ff7eb9',hair:'#5c2a2a'}},
  {name:'Trần Đ.Mạnh', x:620, color:{body:'#a0c4ff',hair:'#5c4b3a'}},
  {name:'Quách D.Trường', x:320, color:{body:'#9be564',hair:'#3a3a2b'}},
  {name:'Mrudav P.Mehta', x:860, color:{body:'#f4a261',hair:'#2b2b2b'}, falling:true, fy:-200, vy:0, parachute:false},
  {name:'Nghiêm M.Hiếu', x:980, color:{body:'#c9f38e',hair:'#2b2b2b'}, hasTV:true}
];

// draw character (pixel style)
function drawCharacter(x,y,obj){ ctx.save(); ctx.translate(x,y); ctx.imageSmoothingEnabled=false; ctx.fillStyle='#f7d7b7'; ctx.fillRect(-12,-48,24,24); ctx.fillStyle=obj.color.hair; ctx.fillRect(-12,-48,24,6); ctx.fillStyle=obj.color.body; ctx.fillRect(-14,-24,28,28); ctx.fillStyle='#000'; ctx.fillRect(-6,-40,4,4); ctx.fillRect(2,-40,4,4); ctx.fillStyle='#fff'; ctx.font='10px monospace'; const nm = obj.name.length>12? obj.name.split(' ')[0] : obj.name; ctx.fillText(nm, -20, 4); ctx.restore(); }

// airplane & mrudav falling
let airplane = {x:-200, y:80, vx:180, active:false};
function drawAirplane(dt){ // simple silhouette
  airplane.x += airplane.vx * dt;
  if(airplane.x > W + 200) airplane.x = -300; // loop
  // body
  ctx.save(); ctx.translate(airplane.x, airplane.y); ctx.fillStyle='#dddddd'; ctx.fillRect(-40,-10,80,20); ctx.fillRect(-10,-20,6,10); ctx.fillStyle='#999'; ctx.fillRect(30,-6,12,4); ctx.restore();
}

// draw parachute if opens
function drawParachute(mx,my,progress){ ctx.save(); ctx.translate(mx,my-40); ctx.fillStyle='rgba(255,100,100,0.9)'; ctx.beginPath(); ctx.moveTo(-60,0); ctx.quadraticCurveTo(0,-40,60,0); ctx.closePath(); ctx.fill(); ctx.restore(); }

// Nghiêm Minh Hiếu's devices: iPhone (small rectangle) + TV (larger rectangle) + 10 floating screens
let screens = []; function initScreens(){ screens = []; for(let i=0;i<10;i++){ screens.push({x:980 + (Math.random()*160-80), y:200 + Math.random()*200-100, vx:(Math.random()-0.5)*20, vy:(Math.random()-0.5)*20, rot:Math.random()*Math.PI*2}); } }
initScreens();

// draw phone + tv
function drawPhone(x,y){ ctx.save(); ctx.translate(x,y); ctx.fillStyle='#000'; ctx.fillRect(-6,-14,12,28); ctx.fillStyle='#1ef'; ctx.fillRect(-4,-10,8,20); ctx.restore(); }
function drawTV(x,y){ ctx.save(); ctx.translate(x,y); ctx.fillStyle='#222'; ctx.fillRect(-36,-22,72,44); ctx.fillStyle='#111'; ctx.fillRect(-32,-18,64,36); ctx.fillStyle='#ffcc00'; ctx.fillRect(-12,-6,24,12); ctx.restore(); }

// particle system
let particles = [];
function spawnParticle(){ particles.push({x: Math.random()*W, y: -10, vx: -2 + Math.random()*4, vy: 2+Math.random()*2, life: 100 + Math.random()*100, t:0, type: Math.random()>0.7?'splash':'wind'}); }
function updateParticles(dt){ particles.forEach(p=>{ p.x += p.vx * dt * 60; p.y += p.vy * dt * 60; p.t += dt * 60; p.life -= dt*60 }); particles = particles.filter(p=>p.life>0); }
function paintParticles(){ particlesEl.innerHTML=''; particles.forEach(p=>{ const el = document.createElement('div'); el.style.position='absolute'; el.style.left=(p.x|0)+'px'; el.style.top=(p.y|0)+'px'; el.style.width='6px'; el.style.height='6px'; el.style.background = p.type==='splash' ? 'rgba(255,255,255,0.9)' : 'rgba(255,255,255,0.25)'; el.style.borderRadius='50%'; el.style.transform='translate(-50%,-50%)'; el.style.filter='blur(0.6px)'; particlesEl.appendChild(el); }); }

// time-layers
const snapshotCanvas = document.createElement('canvas'); const snapshotCtx = snapshotCanvas.getContext('2d'); function ensureSnapshot(){ snapshotCanvas.width = canvas.width; snapshotCanvas.height = canvas.height; } ensureSnapshot(); window.addEventListener('resize', ensureSnapshot);
let snapshots = [];
function captureSnapshot(){ snapshotCtx.clearRect(0,0,snapshotCanvas.width,snapshotCanvas.height); snapshotCtx.drawImage(canvas,0,0); snapshots.push(snapshotCanvas.toDataURL()); if(snapshots.length>8) snapshots.shift(); }
function renderTimeLayers(){ tl1.style.backgroundImage = snapshots[snapshots.length-1] ? `url(${snapshots[snapshots.length-1]})` : 'none'; tl1.style.opacity = timewarpOn ? 0.55 : 0; tl2.style.backgroundImage = snapshots[snapshots.length-3] ? `url(${snapshots[Math.max(0,snapshots.length-3)]})` : 'none'; tl2.style.opacity = timewarpOn ? 0.3 : 0; }

// audio (simple ambience / rumble)
const AudioContext = window.AudioContext || window.webkitAudioContext; const audioCtx = new AudioContext(); const master = audioCtx.createGain(); master.gain.value = 0.0; master.connect(audioCtx.destination);
function startAmbience(){ if(audioCtx.state==='suspended') audioCtx.resume(); const osc = audioCtx.createOscillator(); osc.type='sine'; osc.frequency.value = 40; const g = audioCtx.createGain(); g.gain.value = 0.0; osc.connect(g); g.connect(master); osc.start(); const bufferSize = 2*audioCtx.sampleRate; const noiseBuffer = audioCtx.createBuffer(1, bufferSize, audioCtx.sampleRate); const output = noiseBuffer.getChannelData(0); for (let i=0;i<bufferSize;i++){ output[i] = Math.random()*2-1; } const whiteNoise = audioCtx.createBufferSource(); whiteNoise.buffer = noiseBuffer; const noiseGain = audioCtx.createGain(); noiseGain.gain.value = 0.02; whiteNoise.connect(noiseGain); noiseGain.connect(master); whiteNoise.loop = true; whiteNoise.start(); audioCtx._osc = osc; audioCtx._g = g; audioCtx._noiseGain = noiseGain; audioCtx._noise = whiteNoise; }
function stopAmbience(){ try{ if(audioCtx._g) audioCtx._g.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime+0.3); if(audioCtx._noiseGain) audioCtx._noiseGain.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime+0.3);}catch(e){} }

// shake & flash
function applyShake(intensity){ stage.style.transform = `translate(${(Math.random()-0.5)*intensity}px, ${(Math.random()-0.5)*intensity}px)`; }
function clearShake(){ stage.style.transform = ''; }
function flashWhite(ms=120){ flash.style.background = 'linear-gradient(180deg, rgba(255,255,255,0.85), rgba(255,255,255,0.35))'; flash.style.opacity='1'; flash.style.transition='opacity '+(ms/1000)+'s ease-out'; setTimeout(()=>{ flash.style.opacity='0'; }, 30); setTimeout(()=>{ flash.style.background=''; }, ms+60); }

// surreal pop
let surrealObjects=[]; function spawnSurreal(){ surrealObjects.push({x: Math.random()*W, y: Math.random()*H*0.6, t:0, life:120 + Math.random()*180, id:Math.random()}); }

// main draw
let last = performance.now(); function loop(now){ const dt=(now-last)/1000; last=now; if(!playing){ requestAnimationFrame(loop); return; }
  // update
  if(sensoryOn){ if(Math.random()<0.8) spawnParticle(); if(Math.random()<0.03) flashWhite(120); }
  else { if(Math.random()<0.02) spawnParticle(); }
  updateParticles(dt); paintParticles(); if(surrealOn && Math.random()<0.06) spawnSurreal();

  // clear
  ctx.clearRect(0,0,W,H);
  const t = now/1000;
  // background sky
  const g = ctx.createLinearGradient(0,0,0,H*0.5); g.addColorStop(0,'#0b2340'); g.addColorStop(1,'#07203a'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H*0.5);
  // sun
  ctx.fillStyle='#fff59d'; ctx.beginPath(); ctx.arc(W-140,80,42,0,Math.PI*2); ctx.fill();
  // sea
  ctx.fillStyle='#056b9a'; ctx.fillRect(0,H*0.36,W,H*0.28);
  // sand
  ctx.fillStyle='#f7d488'; ctx.fillRect(0,H*0.64,W,H*0.36);
  // waves
  for(let i=0;i<8;i++){ ctx.fillStyle='rgba(255,255,255,'+ (0.06 + 0.02*Math.sin(t*2+i))+')'; ctx.fillRect((i*60 + (t*30%60))%W,H*0.46,120,6); }
  // Hoa Lo stylized
  ctx.fillStyle='#8b5a3c'; ctx.fillRect(40,H*0.44 - 60,220,120); ctx.fillStyle='#2b2b2b'; ctx.fillRect(120,H*0.44 - 30,60,60); ctx.fillStyle='#e6eef8'; ctx.font='16px monospace'; ctx.fillText('HỎA LÒ', 80, H*0.44 - 36);
  // calendar
  ctx.fillStyle='#fff'; ctx.fillRect(W-160,20,120,120); ctx.fillStyle='#d33'; ctx.font='26px monospace'; ctx.fillText('OCT', W-140, 56);

  // airplane
  drawAirplane(dt);

  // Mrudav falling animation
  const m = chars.find(c=>c.name.startsWith('Mrudav'));
  if(m){ if(airplane.x > 120 && airplane.x < 200 && !m.fallingStarted){ // trigger fall
      m.fallingStarted = true; m.fy = airplane.y + 20; m.vy = 0; m.parachuteOpenAt = performance.now() + 800; }
    if(m.fallingStarted){ // update
      m.vy += 600 * dt; m.fy += m.vy * dt; // gravity
      // parachute opens halfway to make it non-lethal and playful
      if(performance.now() > m.parachuteOpenAt){ m.parachute = true; m.vy *= 0.45; }
      // land on sand (H*0.64 baseline)
      const groundY = H*0.64 - 40;
      if(m.fy >= groundY){ m.fy = groundY; m.vy = 0; m.fallingStarted=false; m.landed=true; }
      // draw Mrudav
      drawCharacter(m.x, m.fy, m);
      if(m.parachute) drawParachute(m.x, m.fy, 1);
    } else {
      // default standing at his x near right
      drawCharacter(m.x, H*0.64 - 40, m);
    }
  }

  // draw other characters (skip Mrudav already drawn)
  chars.forEach(c=>{ if(c.name.startsWith('Mrudav')) return; drawCharacter(c.x, H*0.64 - 40, c); });

  // Draw Nghiêm Minh Hiếu devices
  const nghiem = chars.find(c=>c.name.startsWith('Nghiêm'));
  if(nghiem){ drawPhone(nghiem.x+14, H*0.64 - 60); drawTV(nghiem.x-60, H*0.64 - 30); // animate 10 screens if surrealOn
    if(surrealOn){ screens.forEach(s=>{ s.x += s.vx * dt * 60; s.y += s.vy * dt * 60; s.rot += dt * 1.2; // wrap
        if(s.x < 0) s.x = W; if(s.x > W) s.x = 0; if(s.y < 0) s.y = H*0.6; if(s.y > H*0.8) s.y = 0;
        ctx.save(); ctx.translate(s.x, s.y); ctx.rotate(Math.sin(s.rot)*0.2); ctx.fillStyle='rgba(0,0,0,0.9)'; ctx.fillRect(-20,-12,40,24); ctx.fillStyle='#0ff'; ctx.fillRect(-16,-8,32,16); ctx.restore(); }); }
  }

  // surreal objects
  surrealObjects.forEach((o,idx)=>{ o.t+=dt*60; ctx.save(); ctx.translate(o.x, o.y); const s = 1+Math.sin(o.t*0.1)*0.6; ctx.rotate(Math.sin(o.t*0.03)*0.2); ctx.globalAlpha = Math.max(0, Math.min(1, o.life/240)); ctx.fillStyle = 'rgba(255,255,255,0.8)'; ctx.fillRect(-12*s,-12*s,24*s,24*s); ctx.restore(); o.life -= dt*60; }); surrealObjects = surrealObjects.filter(o=>o.life>0);

  // capture snapshots for timewarp
  if(timewarpOn && Math.random()<0.15) captureSnapshot(); renderTimeLayers();

  // audio
  if(sensoryOn){ master.gain.linearRampToValueAtTime(0.8, audioCtx.currentTime+0.4); applyShake(6);} else { master.gain.linearRampToValueAtTime(0.0, audioCtx.currentTime+0.6); clearShake(); }

  requestAnimationFrame(loop);
}

// controls
document.getElementById('play').onclick = ()=>{ if(!playing){ playing=true; last=performance.now(); loop(last); if(sensoryOn) startAmbience(); } };
document.getElementById('stop').onclick = ()=>{ playing=false; stopAmbience(); clearShake(); };
document.getElementById('sensory').onclick = ()=>{ sensoryOn = !sensoryOn; if(sensoryOn) startAmbience(); else stopAmbience(); };
document.getElementById('timewarp').onclick = ()=>{ timewarpOn = !timewarpOn; if(timewarpOn) snapshots=[]; };
document.getElementById('surreal').onclick = ()=>{ surrealOn = !surrealOn; if(surrealOn) initScreens(); };

document.getElementById('download').onclick = ()=>{ const html = '<!doctype html>\n' + document.documentElement.outerHTML; const blob = new Blob([html], {type:'text/html'}); const url = URL.createObjectURL(blob); const a=document.createElement('a'); a.href=url; a.download='ebite_2d_4d_mrudav_nghiem.html'; a.click(); URL.revokeObjectURL(url); };

// helpers (reused from earlier)
function drawCharacter(x,y,obj){ ctx.save(); ctx.translate(x,y); ctx.imageSmoothingEnabled=false; ctx.fillStyle='#f7d7b7'; ctx.fillRect(-12,-48,24,24); ctx.fillStyle=obj.color.hair; ctx.fillRect(-12,-48,24,6); ctx.fillStyle=obj.color.body; ctx.fillRect(-14,-24,28,28); ctx.fillStyle='#000'; ctx.fillRect(-6,-40,4,4); ctx.fillRect(2,-40,4,4); ctx.fillStyle='#fff'; ctx.font='10px monospace'; const nm = obj.name.length>12? obj.name.split(' ')[0] : obj.name; ctx.fillText(nm, -20, 4); ctx.restore(); }
function drawParachute(x,y,progress){ ctx.save(); ctx.translate(x,y-40); ctx.fillStyle='rgba(255,100,100,0.95)'; ctx.beginPath(); ctx.moveTo(-60,0); ctx.quadraticCurveTo(0,-40,60,0); ctx.closePath(); ctx.fill(); ctx.restore(); }
function drawAirplane(dt){ airplane.x += airplane.vx * dt; if(airplane.x > W + 200) airplane.x = -300; ctx.save(); ctx.translate(airplane.x, airplane.y); ctx.fillStyle='#ddd'; ctx.fillRect(-40,-10,80,20); ctx.fillRect(-10,-20,6,10); ctx.fillStyle='#999'; ctx.fillRect(30,-6,12,4); ctx.restore(); }
function drawPhone(x,y){ ctx.save(); ctx.translate(x,y); ctx.fillStyle='#000'; ctx.fillRect(-6,-14,12,28); ctx.fillStyle='#1ef'; ctx.fillRect(-4,-10,8,20); ctx.restore(); }
function drawTV(x,y){ ctx.save(); ctx.translate(x,y); ctx.fillStyle='#222'; ctx.fillRect(-36,-22,72,44); ctx.fillStyle='#111'; ctx.fillRect(-32,-18,64,36); ctx.fillStyle='#ffcc00'; ctx.fillRect(-12,-6,24,12); ctx.restore(); }

// start with draw once
(function init(){ drawSceneOnce(); })();
function drawSceneOnce(){ ctx.clearRect(0,0,W,H); const t=0; const g=ctx.createLinearGradient(0,0,0,H*0.5); g.addColorStop(0,'#0b2340'); g.addColorStop(1,'#07203a'); ctx.fillStyle=g; ctx.fillRect(0,0,W,H*0.5); ctx.fillStyle='#fff59d'; ctx.beginPath(); ctx.arc(W-140,80,42,0,Math.PI*2); ctx.fill(); ctx.fillStyle='#056b9a'; ctx.fillRect(0,H*0.36,W,H*0.28); ctx.fillStyle='#f7d488'; ctx.fillRect(0,H*0.64,W,H*0.36); for(let i=0;i<8;i++){ ctx.fillStyle='rgba(255,255,255,'+ (0.06 + 0.02*Math.sin(t*2+i))+')'; ctx.fillRect((i*60 + (t*30%60))%W,H*0.46,120,6); }
  ctx.fillStyle='#8b5a3c'; ctx.fillRect(40,H*0.44 - 60,220,120); ctx.fillStyle='#2b2b2b'; ctx.fillRect(120,H*0.44 - 30,60,60); ctx.fillStyle='#e6eef8'; ctx.font='16px monospace'; ctx.fillText('HỎA LÒ', 80, H*0.44 - 36);
  ctx.fillStyle='#fff'; ctx.fillRect(W-160,20,120,120); ctx.fillStyle='#d33'; ctx.font='26px monospace'; ctx.fillText('OCT', W-140, 56);
  chars.forEach(c=>{ if(c.name.startsWith('Mrudav')) return; drawCharacter(c.x, H*0.64 - 40, c); }); const m = chars.find(c=>c.name.startsWith('Mrudav')); drawCharacter(m.x, H*0.64 - 40, m); drawTV(980, H*0.64 - 30); drawPhone(980+14, H*0.64 - 60);
}

// safety: non-graphic, playful animations only
</script>
</body>
</html>
